体育运动学校--人才管理平台
===============

当前最新版本： 2.1.1（发布日期：20191021）



1. 碰到Mysql数据库表不区分大小写问题，请增加修改配置如下：


```
cat /etc/mysql/my.cnf
cat /etc/mysql/mysql.conf.d/mysqld.cnf

vi /etc/mysql/mysql.conf.d/mysqld.cnf

[mysqld]
lower_case_table_names=1 #增加此配置，忽略表名大小写
```



2. online表单开发报资源未找到错误。
  jeecg-boot/ant-design-vue-jeecg/node_modules/@jeecg/antd-online/dist/OnlineForm.umd.min.js 中的 /jeecg-boot 修改为 /edusport


3. 【搜索下拉框】使用指南

```
// 使用对应的检索选择器

          <a-col :md="6" :sm="8">
            <a-form-item label="运动员学号">
              <j-search-select-tag placeholder="请选择运动员" v-model="queryParam.athleteNo" dict="tb_edu_athlete,athlete_name,athlete_no" />
<!--              <a-input placeholder="请输入运动员学号" v-model="queryParam.athleteNo"></a-input>-->
            </a-form-item>
          </a-col>

```

```
  // 引入检索选择器控件
  import JSearchSelectTag from '@/components/dict/JSearchSelectTag.vue'

  export default {
    name: "AthleteSportClassList",
    mixins:[JeecgListMixin],
    components: {

      JSearchSelectTag, // 加载检索选择器控件

    },


```


3. 
全部单表 + 一对多Tab示例

```
修改点：
1. 主表 List.Vue 增加：

1.1  <!-- table区域-begin -->  修改：

涉及 文件上传的需要，filterMultiple="filterMultiple"，
涉及 调整分页高度需要，:pagination="ipagination"
涉及 radio 选择主表一条记录，过滤字表数据，:rowSelection="{selectedRowKeys: selectedRowKeys, onChange: onSelectChange,type:type}"
检查内容使用：:customRow="clickThenCheck"

      <a-table
        ref="table"
        size="middle"
        bordered
        rowKey="id"
        filterMultiple="filterMultiple"
        :columns="columns"
        :dataSource="dataSource"
        :pagination="ipagination"
        :loading="loading"
        :rowSelection="{selectedRowKeys: selectedRowKeys, onChange: onSelectChange,type:tabSelectType}"
        :customRow="clickThenCheck"
        @change="handleTableChange">

1.2  增加 Tab 区域

      ...
      </a-table>
    </div>
    <!-- table区域-end -->

    <a-tabs defaultActiveKey="1">
      <a-tab-pane tab="个人简历" key="1">
        <Coach-Edu-Resume-List ref="CoachEduResumeList"></Coach-Edu-Resume-List>
      </a-tab-pane>
      <a-tab-pane tab="运动经历" key="2" forceRender>
        <Coach-Sport-Resume-List ref="CoachSportResumeList"></Coach-Sport-Resume-List>
      </a-tab-pane>
      <a-tab-pane tab="培训经历" key="3" forceRender>
        <Coach-Training-List ref="CoachTrainingList"></Coach-Training-List>
      </a-tab-pane>
      <a-tab-pane tab="论文发表" key="4" forceRender>
        <Coach-Paper-List ref="CoachPaperList"></Coach-Paper-List>
      </a-tab-pane>
    </a-tabs>

1.3 
<script> 区域增加 import 引入子表List和Modal资源

---import 区域--- 添加引入资源

  ...
  import CoachEduResumeList from './CoachEduResumeList'
  import CoachEduResumeModal from './modules/CoachEduResumeModal'
  ...

---components 区域--- 添加加载资源
    components: {
      ...
      CoachEduResumeList,
      CoachEduResumeModal,
      ...
    }

---data ipagination 区域 --- 修改分页记录
        /* 分页参数 */
        ipagination:{
          current: 1,
          pageSize: 5,
          pageSizeOptions: ['5', '10', '20'],
          showTotal: (total, range) => {
            return range[0] + "-" + range[1] + " 共" + total + "条"
          },
          showQuickJumper: true,
          showSizeChanger: true,
          total: 0
        },

---Table记录选择器修改为单选框 radio --- 增加
        tabSelectType: "radio",
        url: {

---方法区域--- 增加对应的function
      clickThenCheck(record) {
        return {
          on: {
            click: () => {
              this.onSelectChange(record.id.split(","), [record]);
            }
          }
        };
      },

      onSelectChange(selectedRowKeys, selectionRows) {
        this.selectedRowKeys = selectedRowKeys;
        this.selectionRows = selectionRows;
        let coachNo = this.selectionRows[0].coachNo;
        let coachId = this.selectedRowKeys[0];

        ...
        this.$refs.CoachEduResumeList.getListByCoachNo(coachNo);
        this.$refs.CoachEduResumeList.getListByCoachId(coachId);
        ...

      },

      onClearSelected() {
        this.selectedRowKeys = [];
        this.selectionRows = [];

        ...
        this.$refs.CoachEduResumeList.queryParam.coachNo = null;
        this.$refs.CoachEduResumeList.queryParam.coachId = null;
        this.$refs.CoachEduResumeList.loadData();
        this.$refs.CoachEduResumeList.selectedRowKeys = [];
        this.$refs.CoachEduResumeList.selectionRows = [];
        ...
      },

      searchQuery:function(){
        this.selectedRowKeys = [];
        this.selectionRows = [];

        ...
        this.$refs.CoachEduResumeList.queryParam.coachNo = null;
        this.$refs.CoachEduResumeList.queryParam.coachId = null;
        this.$refs.CoachEduResumeList.loadData();
        this.$refs.CoachEduResumeList.selectedRowKeys = [];
        this.$refs.CoachEduResumeList.selectionRows = [];
        ...

        this.loadData();
      }

2. 子表修改

--- CoachEduResumeList ---

2.1
    <!-- 操作按钮区域 -->
    <div class="table-operator" :md="24" :sm="24" style="margin: -25px 0px 10px 0px">

    <!-- 去掉 【导出】【导入】-->

2.2
--- <script> 的 method 区域 --- 增加对应的method
      getListByCoachNo(coachNo) {
        this.queryParam.coachNo = coachNo;
        this.loadData(1);
      },
      handleAdd: function () {
        this.$refs.modalForm.add(this.queryParam.coachNo);
        this.$refs.modalForm.title = "添加个人简历";
        this.$refs.modalForm.disableSubmit = false;
      },

2.3 修改样式
<style scoped>
  .ant-card {
    margin-left: -30px;
    margin-right: -30px;
  }
</style>


3. 子表 Modal 修改
【增加】功能必须主表选择一条记录。
      add(coachNo) {
        this.hiding = true;
        if (coachNo) {
          this.coachNo = coachNo;
          this.edit({coachNo}, '');
        } else {
          this.$message.warning("请选择一个教练员信息");
        }
      },



【新增】页面
<input> 多行修改内容
每行两列
      <a-form :form="form">
        <a-row>
          <a-col :span="12">
          </a-col>
          <a-col :span="12">
          </a-col>
        </a-row>

        <a-row>
          <a-col :span="8">
          </a-col>
          <a-col :span="8">
          </a-col>
          <a-col :span="8">
          </a-col>         
        </a-row>
      </a-form>

每列适配
        <a-form-item label="最高训练单位" :labelCol="labelCol" :wrapperCol="wrapperCol">
          <a-input v-decorator="[ 'contestScore', validatorRules.contestScore]" placeholder="请输入最高训练单位"></a-input>
        </a-form-item>


        labelCol: {
          xs: { span: 24 },
          sm: { span: 5 },
          md: { span: 5 },
        },
        wrapperCol: {
          xs: { span: 24 },
          sm: { span: 16 },
          md: { span: 16 },
        },

        labelCol2: {
          xs: { span: 24 },
          sm: { span: 8 },
          md: { span: 8 },
        },
        wrapperCol2: {
          xs: { span: 24 },
          sm: { span: 14 },
          md: { span: 14 },
        },

        labelCol3: {
          xs: { span: 24 },
          sm: { span: 8 },
          md: { span: 8 },
        },
        wrapperCol3: {
          xs: { span: 24 },
          sm: { span: 14 },
          md: { span: 14 },
        },


```



@上传图片控件【Token失效，请重新登录】问题,为上传控件设置header
```
    <a-upload
      :action="uploadAction"
      listType="picture-card"
      :headers="headers"
      :fileList="fileList"
      @change="handlePicChange"
      @preview="handlePicPreview"
    >

  import Vue from 'vue'
  import {ACCESS_TOKEN} from "@/store/mutation-types"

    data () {
      return {
        ...
        url: {
          fileUpload: window._CONFIG['domianURL'] + "/sys/common/upload",
          imgerver: window._CONFIG['domianURL'] + "/sys/common/view",
        }
        ...
      }
    }

    created() {
      const token = Vue.ls.get(ACCESS_TOKEN);
      this.headers = {"X-Access-Token": token}
    },



```


5. 抽屉风格编辑页面

```
<template>
  <a-drawer
    :title="title"
    :width="drawerWidth"
    :maskClosable="true"
    placement="right"
    :closable="true"
    @close="close"
    :visible="visible"
    style="height: calc(100% - 55px);overflow: auto;padding-bottom: 53px;">

    ...

    <div class="drawer-bootom-button" v-show="!disableSubmit">
      <a-popconfirm title="确定放弃编辑？" @confirm="handleCancel" okText="确定" cancelText="取消">
        <a-button style="margin-right: .8rem">取消</a-button>
      </a-popconfirm>
      <a-button type="primary" @click="handleOk" :loading="confirmLoading">提交</a-button>
    </div>
  </a-drawer>
</template>


<script>
  export default {
    ...

    data () {
      return {
        ...
        drawerWidth:800, 
        disableSubmit:false,
        ...
      }
    },

    methods: {

      ...
      edit (record) {
        this.resetScreenSize(); // 调用此方法,根据屏幕宽度自适应调整抽屉的宽度
        ...
      }

      ...
      close () {
        this.$emit('close');
        this.visible = false;
        this.disableSubmit = false;
      }, 

      // 根据屏幕变化,设置抽屉尺寸
      resetScreenSize(){
        let screenWidth = document.body.clientWidth;
        if(screenWidth < 500){
          this.drawerWidth = screenWidth;
        }else{
          this.drawerWidth = 700;
        }
      },
      
      ...
    }
  }
</script>


<style lang="less" scoped>
  .drawer-bootom-button {
    position: absolute;
    bottom: -8px;
    width: 100%;
    border-top: 1px solid #e8e8e8;
    padding: 10px 16px;
    text-align: right;
    left: 0;
    background: #fff;
    border-radius: 0 0 2px 2px;
  }
</style>
```




6. 联动显示的问题

```
列表页table列中显示：

  export default {
    data () {
        // 表头
        columns: [
          {
            title:'训练队成员',
            align:"center",
            dataIndex: 'athleteSportClassId',
            customRender:(text)=>{
              if(!text){
                return ''
              }else{
                let athlete_id = filterMultiDictText(this.dictOptions['athleteSportClassId'], text+"")
                return filterMultiDictText(this.dictOptions['athlete_id'], athlete_id+"")
              }
            }
          },
      ...
    },

    methods: {
      initDictConfig(){
        initDictOptions('tb_edu_athlete_sport_class,athlete_id,id').then((res) => {
          if (res.success) {
            this.$set(this.dictOptions, 'athleteSportClassId', res.result)
          }
        })
        initDictOptions('tb_edu_athlete,athlete_name,id').then((res) => {
          if (res.success) {
            this.$set(this.dictOptions, 'athlete_id', res.result)
          }
        })
      },

    }

```
```
Modal页显示

    <!-- 使用联动结果 -->
        <a-form-item label="训练队成员" :labelCol="labelCol" :wrapperCol="wrapperCol">
          {{athleteName}}
        </a-form-item>

  // 引入字典选择器
  import {initDictOptions, filterMultiDictText} from '@/components/dict/JDictSelectUtil'

  export default {
      //初始化
      data () {
        ...
        athleteName:'',
        dictOptions:{
        },
        ...
      }


      methods: {
        // 初始化字典并获取训练队成员
        initDictConfig(){
          initDictOptions('tb_edu_athlete_sport_class,athlete_id,id').then((res) => {
            if (res.success) {
              this.$set(this.dictOptions, 'athleteSportClassId', res.result)
            }
          })
          initDictOptions('tb_edu_athlete,athlete_name,id').then((res) => {
            if (res.success) {
              this.$set(this.dictOptions, 'athlete_id', res.result)
            }
          })

          // initDictOptions 因方法耗时，因此延时500ms获取 训练队成员姓名
          // 最稳妥的方法
          let callback = (function ()  {
            let athleteSportClassId = this.model.athleteSportClassId
            if(!athleteSportClassId){
              return ''
            }else {
              let athlete_id = filterMultiDictText(this.dictOptions['athleteSportClassId'], athleteSportClassId+"")
              this.athleteName = filterMultiDictText(this.dictOptions['athlete_id'], athlete_id + "")
            }
          }).bind(this)
          setTimeout(callback, 500)
        },

        edit (record) {
        this.resetScreenSize(); // 调用此方法,根据屏幕宽度自适应调整抽屉的宽度
        this.form.resetFields();
        this.model = Object.assign({}, record);
        this.visible = true;
        this.$nextTick(() => {
          this.form.setFieldsValue(pick(this.model,'athleteSportClassId','startDate','endDate','evaluation','evaluator'))
        })

        // 初始化字典并获取训练队成员
        this.initDictConfig()
      },

```


7. 延时加载的问题

在setTimeout中定义的函数时，奇怪的this对象
```
  // 第一种，标准调用
  // this指向window对象,因为回调函数是在全局环境下调用的
  window.setTimeout(function () { console.log(this) }, 0)
  
  // 第二种，箭头函数调用
  // 箭头函数在定义时确定this对象的,是vue实例
  window.setTimeout(() => console.log(this), 0)

  // 第三种，立即执行函数
  window.setTimeout((function () {
      // this竟然是undefined！不可思议
      // 事实上，this为undefined的情况就只有模块的顶层对象
      // 也就是说，这里的this指向的就是当前vue模块的顶层对象（？？？）
      console.log(this)
      // this是window对象
      return function () { console.log(this) }
  })(), 1000)


  // 最稳妥的方法
  var callback = (function ()  {
    console.log(this)
  }).bind(this)
  setTimeout(callback, 0)

```
```
        // initDictOptions 因方法耗时，因此延时500ms获取 训练队成员姓名
        // 最稳妥的方法
        let callback = (function ()  {
          let athleteSportClassId = this.model.athleteSportClassId
          if(!athleteSportClassId){
            return ''
          }else {
            let athlete_id = filterMultiDictText(this.dictOptions['athleteSportClassId'], athleteSportClassId+"")
            this.athleteName = filterMultiDictText(this.dictOptions['athlete_id'], athlete_id + "")
          }
        }).bind(this)
        setTimeout(callback, 500)

        // setTimeout(() => {
        //   let athleteSportClassId = this.model.athleteSportClassId
        //   if(!athleteSportClassId){
        //     return ''
        //   }else {
        //     let athlete_id = filterMultiDictText(this.dictOptions['athleteSportClassId'], athleteSportClassId+"")
        //     this.athleteName = filterMultiDictText(this.dictOptions['athlete_id'], athlete_id + "")
        //   }
        // }, 500)
```


request提交请求，返回无权限的错误信息，
原因是 url的request请求类型和 java注解类型不一致。如：前端使用的getAction(url, parameter)，后端注解的是@PutMapping("url")
后端 Java的 @RestController 和 前端的 Request类型要匹配。
```

```


图表功能设计
设计通过的图表查询功能



todolist

身体机能测评
请假申请
公告消息
一两张报表
创建冻结账号
关联删除
权限调整




训练队中增加 训练队成员tab




/dashboard/analysis
dashboard/Analysis




参考案例中的百度

所属类别
标题
副标题
显示顺序
启用状态
来源
报道日期
简介
内容
图片
连接
标签？
 



bannar管理
所在位置
显示顺序
启用状态
图片
活动名称
连接地址
说明




大纲测试管理（菜单与页面结构）
  测试管理：（页面）
            运动员选材测试批次列表
              子tab 运动员选材测试成绩列表（新增、编辑包括 成绩表及成绩子表编辑内容，自动计算）
                孙tab 运动员选材测试成绩明细列表（仅显示）

  测试组别标准管理： （页面）
                    测试组别列表（CRUD）
                    子tab 测试组别标准指标明细列表（【设置】包含明细的增减）
                      孙tab 测试指标评分标准列表（基础资料）
                    子tab 测试等级评定标准列表（基础资料，tab不用过滤）
                    
  测试指标管理：（页面）
                测试指标列表（基础资料）
                子tab 测试指标类别列表（基础资料，tab不用过滤）


大纲测试管理（表结构与页面显示）
测试管理
      表结构：（运动员选材测试批次表）id，测试名称，大项code，测试组别id，发布日期，
      列表页显示：测试名称，大项，测试组别，发布日期
      操作功能：新增，查看，编辑，删除，导入，导出（报表，先不做）
  运动员测试成绩
      表结构：（运动员选材测试成绩表）id, 运动员id, 所属测试id，测试组别id，小项code，得分（总分，计算所得），测试等级评定（计算所得），测试日期
      列表页显示：（运动员，身份证号，性别，出生日期，得分，测试等级评定，所属测试，测试组别标准）
      编辑显示：（运动员，性别，出生日期，测试日期，得分（总分），测试等级评定）测试指标，测试值，单位，得分，测试等级评定，所属指标类别
      操作功能：新增，查看，编辑，删除
    运动员测试成绩明细
      表结构：（运动员选材测试成绩明细表）id，运动员测试成绩id，运动员id, 所属测试id，测试组别id，小项code，指标小类code，测试值，得分（计算所得，计算参数：测试组别id，指标小类code，性别，年龄，测试值），等级（计算所得）
      列表页显示：运动员，性别，年龄，测试指标，测试值，单位，得分，测试等级评定，所属指标类别
      操作功能：无

测试组别标准管理
    表结构：（测试组别标准表）id，组别名称，大项代码，在训小项code数组
    列表页显示：（组别名称， 大项，小项（联动大项，多选下拉选择器））
    操作功能：新增，查看，编辑，删除
  测试组别标准指标明细：绑定指标（四级选择，类别，大类，种类，小类）
    表结构：（测试组别标准的指标明细表）id, 组别id，指标小类code
    详情页显示：（组别名称，所属大项，在训小项，可绑定指标，已绑定指标）
    操作功能：新增，查看，编辑，删除
  测试指标评分标准列表
    表结构：（测试评分标准表）id，组别id，指标小类code，性别，起始年龄，截止年龄，最小数值，最大数值，得分
    详情页显示：测试指标（2级联动下拉框：指标类别名称，指标名称），性别（下拉框），年龄范围（输入框：起始年龄，截止年龄），评分标准范围（输入框：最小数值，最大数值），得分。
    操作功能：新增，查看，编辑，删除，
  测试指标等级评定标准：
    表结构：（测试等级评定标准表）id，组别id，最小分值，最大分值，等级
    详情页显示：（最小分值，最大分值，等级）
    操作功能：新增，查看，编辑，删除，


测试指标管理
    表结构：（测试指标表）id, 指标类别id，大类code，中类code，小类code，中文名称，英文名称，英文简称，单位，启用状态
    列表页显示：（指标类别, 大类，中类，小类(唯一判断)，名称，单位，启用状态）；
    操作功能：新增，查看，编辑，删除，启用，禁用
  测试指标类别
    表结构：（测试指标类别表）id，指标类别名称
    详情页显示：（指标类别名称）
    操作功能：新增，查看，编辑，删除，





















